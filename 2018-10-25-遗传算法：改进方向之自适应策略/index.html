<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="dothinking">
        <link rel="canonical" href="https://dothinking.github.io/2018-10-25-%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95%EF%BC%9A%E6%94%B9%E8%BF%9B%E6%96%B9%E5%90%91%E4%B9%8B%E8%87%AA%E9%80%82%E5%BA%94%E7%AD%96%E7%95%A5/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>遗传算法：改进方向之自适应策略 - 格致</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../css/extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">格致</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../categories/2021/" class="nav-link">2021</a>
                            </li>
                            <li class="navitem">
                                <a href="../categories/2020/" class="nav-link">2020</a>
                            </li>
                            <li class="navitem">
                                <a href="../categories/2019/" class="nav-link">2019</a>
                            </li>
                            <li class="navitem">
                                <a href="../categories/2018/" class="nav-link">2018</a>
                            </li>
                            <li class="navitem">
                                <a href="../categories/2017/" class="nav-link">2017</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">More <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../categories/2016/" class="dropdown-item">2016</a>
</li>
                                    
<li>
    <a href="../categories/2015/" class="dropdown-item">2015</a>
</li>
                                    
<li>
    <a href="../categories/2014/" class="dropdown-item">2014</a>
</li>
                                    
<li>
    <a href="../categories/2013/" class="dropdown-item">2013</a>
</li>
                                    
<li>
    <a href="../categories/2012/" class="dropdown-item">2012</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/dothinking/dothinking.github.io/edit/master/docs/2018-10-25-遗传算法：改进方向之自适应策略.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#_1" class="nav-link">遗传算法：改进方向之自适应策略</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#_2" class="nav-link">自适应交叉概率</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_3" class="nav-link">自适应变异程度</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_4" class="nav-link">测试</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="_1">遗传算法：改进方向之自适应策略<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<hr />
<p><a href="../2018-10-21-%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95%EF%BC%9A%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E5%8F%8APython%E5%AE%9E%E7%8E%B0/">前文</a>基于经典遗传算法的基本原理，使用Python的<code>Numpy</code>模块实现了求解单目标无约束优化问题的程序。但是，针对二元函数最小值的求解结果表明其精度有待提高，本文将根据自适应遗传算法（Adaptive Genetic Algorithm，AGA）的原理改进之前的代码。</p>
<p>自适应遗传算法的改进点在于 <strong>自适应调整遗传参数</strong>，使得保持群体多样性的同时，保证了算法的收敛性。例如对于基本遗传算法，交叉、变异的概率是固定的，自适应策略则要求在进化过程中进行自适应调整：开始阶段选取较大交叉、变异概率，这样的粗略搜索过程有利于保持种群多样性，后期则调整为较小值以进行细致搜索，防止破化最优解，加快收敛速度。</p>
<h2 id="_2">自适应交叉概率<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>本文采用的自适应策略为根据参与交叉操作的两个个体<code>a</code>、<code>b</code>的适应度<span><span class="MathJax_Preview">f_a, f_b</span><script type="math/tex">f_a, f_b</script></span>调整交叉概率：适应度越大交叉概率越小，反之同理。首先设定交叉概率区间<span><span class="MathJax_Preview">[P_{min}, P_{max}]</span><script type="math/tex">[P_{min}, P_{max}]</script></span>，然后计算种群个体适应度<span><span class="MathJax_Preview">f_i</span><script type="math/tex">f_i</script></span>，及平均适应度<span><span class="MathJax_Preview">f_{avg}</span><script type="math/tex">f_{avg}</script></span>、最大适应度<span><span class="MathJax_Preview">f_{max}</span><script type="math/tex">f_{max}</script></span>，那么交叉概率<span><span class="MathJax_Preview">P</span><script type="math/tex">P</script></span>由下式确定：</p>
<p>\begin{align*}
P &amp;= P_{max}\,\,\,(f &lt; f_{avg})\\\
P &amp;= P_{max} - (P_{max}-P_{min}) \frac{f-f_{avg}}{f_{max}-f_{avg}} \,\,\,(f \geq f_{avg})
\end{align*}</p>
<p>其中，<span><span class="MathJax_Preview">f=max(f_a, f_b)</span><script type="math/tex">f=max(f_a, f_b)</script></span>为参与交叉操作的两个个体中适应度较大者。</p>
<p>得益于之前程序的非耦合性，只需修改<code>GAOperators</code>模块的<code>Crossover</code>类即可。</p>
<pre class="highlight"><code class="language-python">#----------------------------------------------------------
# GAOperators.py: Selection, Crossover, Mmutation
#----------------------------------------------------------
# ... ...
class Crossover:
    def __init__(self, rate=0.8, alpha=0.5):
        '''
        crossover operation:
            rate: propability of crossover. adaptive rate when it is a list, e.g. [0.6,0.9]
                    if f&lt;f_avg then rate = range_max
                    if f&gt;=f_avg then rate = range_max-(range_max-range_min)*(f-f_avg)/(f_max-f_avg)
                    where f=max(individual_a, individual_b)
            alpha: factor for crossing two chroms, [0,1]
        '''
        # parameters check is skipped
        self.rate = rate
        self.alpha = alpha      

    @staticmethod
    def cross_individuals(individual_a, individual_b, alpha):
        '''
        generate two child individuals based on parent individuals:
        new values are calculated at random positions
        alpha: linear ratio to cross two genes, exchange two genes if alpha is 0.0
        '''
        # random positions to be crossed
        pos = np.random.rand(individual_a.dimension) &lt;= 0.5

        # cross value
        temp = (individual_b.solution-individual_a.solution)*pos*(1-alpha)
        new_value_a = individual_a.solution + temp
        new_value_b = individual_b.solution - temp

        # return new individuals
        new_individual_a = Individual(individual_a.ranges)
        new_individual_b = Individual(individual_b.ranges)

        new_individual_a.solution = new_value_a
        new_individual_b.solution = new_value_b

        return new_individual_a, new_individual_b

    def cross(self, population):

        adaptive = isinstance(self.rate, list)
        # adaptive rate
        if adaptive:
            fitness = [I.fitness for I in population.individuals]
            fit_max, fit_avg = np.max(fitness), np.mean(fitness)

        new_individuals = []        
        random_population = np.random.permutation(population.individuals) # random order
        num = int(population.size/2.0)+1

        for individual_a, individual_b in zip(population.individuals[0:num+1], random_population[0:num+1]):         
            # adaptive rate
            if adaptive:
                fit = max(individual_a.fitness, individual_b.fitness)
                if fit_max-fit_avg:
                    i_rate = self.rate[1] if fit&lt;fit_avg else self.rate[1] - (self.rate[1]-self.rate[0])*(fit-fit_avg)/(fit_max-fit_avg)
                else:
                    i_rate = (self.rate[0]+self.rate[1])/2.0
            else:
                i_rate = self.rate

            # crossover
            if np.random.rand() &lt;= i_rate:
                child_individuals = self.cross_individuals(individual_a, individual_b, self.alpha)
                new_individuals.extend(child_individuals)
            else:
                new_individuals.append(individual_a)
                new_individuals.append(individual_b)

        population.individuals = np.array(new_individuals[0:population.size+1])


if __name__ == '__main__':
    # 普通Crossover实例创建方式
    C = Crossover(0.9, 0.75)

    # 自适应Crossover实例创建方式
    C = Crossover([0.5, 0.9], 0.75)</code></pre>
<h2 id="_3">自适应变异程度<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>前文的变异操作由变异概率和变异程度（下式中的<span><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span>）共同决定：</p>
<p>\begin{align*}
g &amp;= g - (g-L)\alpha\,\,\,(rand() \leq 0.5)\\\
g &amp;= g + (U-g)\alpha\,\,\,(rand()&gt;0.5)
\end{align*}</p>
<p>为了使种群在进化的后期趋于稳定，应减小变异作用。相应措施为减小变异概率或者变异程度，本文采用与进化代数负相关的变异程度值，即设置<span><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span>与进化代数<span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>，总代数<span><span class="MathJax_Preview">N</span><script type="math/tex">N</script></span>的关系为：</p>
<div>
<div class="MathJax_Preview">
\alpha = 1.0 - rand()^{1.0-\frac{n}{N}}
</div>
<script type="math/tex; mode=display">
\alpha = 1.0 - rand()^{1.0-\frac{n}{N}}
</script>
</div>
<p>相应地，仅需修改<code>GA</code>模块遗传算法类<code>GA</code>的<code>run()</code>函数：</p>
<pre class="highlight"><code class="language-python">#----------------------------------------------------------
# GA.py: Simple Genetic Algorithm
#----------------------------------------------------------
# ... ...

# # mutation
# self.mutation.mutate(self.population, np.random.rand())

# mutation
rate = 1.0 - np.random.rand()**(1.0-n/gen)
self.mutation.mutate(self.population, rate)</code></pre>
<h2 id="_4">测试<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>依然采用二元函数<code>Schaffer_N4</code>进行测试，最小值点<span><span class="MathJax_Preview">f(0,1.25313)=0.292579</span><script type="math/tex">f(0,1.25313)=0.292579</script></span>。</p>
<div>
<div class="MathJax_Preview">
f(x,y) = 0.5 + \frac{\cos^2 \left[\sin\left(|x^2-y^2| \right) \right] -0.5}{\left[1+0.001\left(x^2+y^2\right)\right]^2} \,\,\,\, \left(-10 \leq (x,y) \leq 10\right)
</div>
<script type="math/tex; mode=display">
f(x,y) = 0.5 + \frac{\cos^2 \left[\sin\left(|x^2-y^2| \right) \right] -0.5}{\left[1+0.001\left(x^2+y^2\right)\right]^2} \,\,\,\, \left(-10 \leq (x,y) \leq 10\right)
</script>
</div>
<p><img alt="" src="../images/2018-10-21-01.jpg" /></p>
<pre class="highlight"><code class="language-python">#----------------------------------------------------------
# test.py
#----------------------------------------------------------
from GAComponents import Individual, Population
from GAOperators import RouletteWheelSelection, Crossover, Mutation

# schaffer-N4
# sol: x=[0,1.25313], min=0.292579
schaffer_n4 = lambda x: 0.5 + (np.cos(np.sin(abs(x[0]**2-x[1]**2)))**2-0.5) / (1.0+0.001*(x[0]**2+x[1]**2))**2  

I = Individual([(-10,10)]*2)
P = Population(I, 50)
S = RouletteWheelSelection()
C = Crossover([0.5, 0.9], 0.75)  # 设定自适应交叉概率区间
M = Mutation(0.2)
g = GA(P, S, C, M)

res = []
for i in range(10):
    res.append(g.run(schaffer_n4, 500).evaluation)

val = schaffer_n4([0,1.25313])
val_ga = sum(res)/len(res)

print('the minimum: {0}'.format(val))
print('the GA minimum: {0}'.format(val_ga))
print('error: {:&lt;3f} %'.format((val_ga/val-1.0)*100))

#----------------------------------------------------------
# output:
#----------------------------------------------------------
the minimum: 0.29257863204552975
the GA minimum: 0.29304050741946297
error: 0.1578636726489835 %</code></pre>
<p>经过自适应交叉和变异策略的改进，该算法求解二元函数<code>Schaffer_N4</code>最小值的平均误差度由<code>3%</code>下降至<code>0.2%</code>左右。</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2016 - 2021 Dothinking</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
